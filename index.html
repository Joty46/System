<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/31a20b87d9.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>


    <style>
        body {
            color: #404E67;
            background: #F5F7FA;
            font-family: 'Open Sans', sans-serif;
        }

        .table-wrapper {
            width: 900px;
            margin: 30px auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
        }

        .table-title {
            padding-bottom: 10px;
            margin: 0 0 10px;
        }

        .table-title h2 {
            margin: 6px 0 0;
            font-size: 22px;
        }

        .table-title .add-new {
            float: right;
            height: 30px;
            font-weight: bold;
            font-size: 12px;
            text-shadow: none;
            min-width: 100px;
            border-radius: 50px;
            line-height: 13px;
        }

        .table-title .add-new i {
            margin-right: 4px;
        }

        table.table {
            table-layout: fixed;
        }

        table.table tr th,
        table.table tr td {
            border-color: #e9e9e9;
        }

        table.table th i {
            font-size: 13px;
            margin: 0 5px;
            cursor: pointer;
        }

        table.table th:last-child {
            width: 100px;
        }

        table.table td a {
            cursor: pointer;
            display: inline-block;
            margin: 0 5px;
            min-width: 24px;
        }

        table.table td a.add {
            color: #27C46B;
        }

        table.table td a.edit {
            color: #FFC107;
        }

        table.table td a.delete {
            color: #E34724;
        }

        table.table td i {
            font-size: 19px;
        }

        table.table td a.add i {
            font-size: 24px;
            margin-right: -1px;
            position: relative;
            top: 3px;
        }

        table.table .form-control {
            height: 32px;
            line-height: 32px;
            box-shadow: none;
            border-radius: 2px;
        }

        table.table .form-control.error {
            border-color: #f50000;
        }

        table.table td .add {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <nav class="pt-3">
                    <ul class="nav nav-pills nav-tabs flex-column admin-menu" role="tablist">

                        <li class="nav-item"><a class="nav-link active" href="" data-target-id="users"><i
                                    class="fa fa-user fa-fw"></i> Users</a>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="" data-target-id="ds"><i
                                    class="fa-solid fa-bag-shopping"></i></i> Products</a>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="" data-target-id="order"><i
                                    class="fa-solid fa-cart-plus"></i> Orders</a>
                        </li>
                    </ul>
                </nav>

            </div>
            <div class="col-md-9 well admin-content" id="users">
                <div class="table-responsive">
                    <div class="table-wrapper">
                        <div class="table-title">
                            <div class="row">
                                <div class="col-sm-8">
                                    <h2>Users <b>Details</b></h2>
                                </div>
                                <div class="col-sm-4"><button type="button" class="btn btn-info add-new"><i
                                            class="fa fa-plus"></i>Add New</button></div>
                            </div>
                        </div>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Admin</td>
                                    <td>admin@gmail.com</td>
                                    <td>Controller</td>
                                    <td><a class="add" title="Add" data-toggle="tooltip"><i
                                                class="fa-solid fa-plus"></i></a><a class="delete" title="Delete"
                                            data-toggle="tooltip"><i class="fa-solid fa-trash"></i></a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
            <div class="col-md-9 well admin-content" id="ds">
                <div class="table-responsive">
                    <div class="table-wrapper">
                        <div class="table-title">
                            <div class="row">
                                <div class="col-sm-8">
                                    <h2><b>Products</b></h2>
                                </div>
                            </div>
                        </div>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Product ID</th>
                                    <th>Username</th>
                                    <th>Product Name</th>
                                    <th>Price</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-9 well admin-content" id="order">
                <div class="table-responsive">
                    <div class="table-wrapper">
                        <div class="table-title">
                            <div class="row">
                                <div class="col-sm-8">
                                    <h2><b>Orders</b></h2>
                                </div>
                            </div>
                        </div>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Customer Name</th>
                                    <th>Product Name</th>
                                    <th>Quantity</th>
                                    <th>Address</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";
    import { getDatabase, ref, set, onValue, child, get, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyByVoh6frLKCh-8YPTk3yMsI7uyeCxmUqc",
        authDomain: "kutibari-9a550.firebaseapp.com",
        databaseURL: "https://kutibari-9a550-default-rtdb.firebaseio.com",
        projectId: "kutibari-9a550",
        storageBucket: "kutibari-9a550.appspot.com",
        messagingSenderId: "604567826648",
        appId: "1:604567826648:web:96ff740379734549bda7ad",
        measurementId: "G-HP9BM7JB0M"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);


    const dbRef = ref(getDatabase());

    $(document).ready(function () {
        var navItems = $('.admin-menu li > a');
        var navListItems = $('.admin-menu li a');
        var allWells = $('.admin-content');
        var allWellsExceptFirst = $('.admin-content:not(:first)');

        allWellsExceptFirst.hide();

        navItems.click(function (e) {
            e.preventDefault();
            navListItems.removeClass('active');
            $(this).closest('li a').addClass('active');

            allWells.hide();
            var target = $(this).attr('data-target-id');
            $('#' + target).show();
        }

        );
    }

    );

    get(child(dbRef, `users`)).then((snapshot) => {
        if (snapshot.exists())
        {

            snapshot.forEach(element => {
                console.log(element.val().role);
            });

            $(document).ready(function () {
                var navItems = $('.admin-menu li > a');
                var navListItems = $('.admin-menu li a');
                var allWells = $('.admin-content');
                var allWellsExceptFirst = $('.admin-content:not(:first)');

                allWellsExceptFirst.hide();

                navItems.click(function (e) {
                    e.preventDefault();
                    navListItems.removeClass('active');
                    $(this).closest('li a').addClass('active');

                    allWells.hide();
                    var target = $(this).attr('data-target-id');
                    $('#' + target).show();
                }

                );
            }

            );

            $(document).ready(function () {
                $('#users [data-toggle="tooltip"]').tooltip();
                var actions = $("#users table td:last-child").html();

                $("#users .add-new").click(function () {
                    $(this).attr("disabled", "disabled");
                    var index = $("#users table tbody tr:last-child").index();
                    var row = '<tr>' + '<td><input type="text" class="form-control" name="name" id="name"></td>' + '<td><input type="text" class="form-control" name="department" id="department"></td>' + '<td><input type="text" class="form-control" name="role" id="role"></td>' + '<td>' + actions + '</td>' + '</tr>';
                    $("#users table").append(row);
                    $("#users table tbody tr").eq(index + 1).find(".add, .edit").toggle();
                    $('#users [data-toggle="tooltip"]').tooltip();
                }

                );

                $(document).on("click", "#users .add", function () {
                    var empty = false;
                    var input = $(this).parents("tr").find('input[type="text"]');

                    input.each(function () {
                        if (!$(this).val())
                        {
                            $(this).addClass("error");
                            empty = true;
                        } else
                        {
                            $(this).removeClass("error");
                        }
                    }

                    );
                    $(this).parents("tr").find(".error").first().focus();

                    if (!empty)
                    {
                        let arr = [];
                        input.each(function (i) {
                            arr.push($(this).val());
                            $(this).parent("td").html($(this).val());
                        });

                        // $.post('adminadd.php', {
                        //     "arr": JSON.stringify(arr)
                        // },
                        //     function () {
                        //         console.log("helo");
                        //     }
                        // );
                        $(this).parents("tr").find(".add").toggle();
                        $("#users .add-new").removeAttr("disabled");
                    }
                }

                );

                $(document).on("click", "#users .delete", function () {
                    $.post('admindelete.php', {
                        "k": $(this).parents("tr").find(":first-child").text(),
                        "type": "user",
                        "pk": "username"
                    },
                        function () {
                            console.log("helo");
                        }
                    );
                    $(this).parents("tr").remove();
                    $(".add-new").removeAttr("disabled");
                }

                );
            }

            );
            $(document).ready(function () {
                var actions = $("#users table td:last-child").html();

                snapshot.forEach(element => {
                    var row = '<tr>' + '<td>' + element.val().username + '</td> <td> ' + element.val().mail + '</td> <td>' + element.val().role + '<td>' + actions + '</td>' + '</tr>';
                    $("#users table").append(row);
                    console.log(element.val().role);
                });

            }

            )

        }
        else
        {
            console.log("No data available");
        }
    }).catch((error) => {
        console.error(error);
    });



    get(child(dbRef, `AllProduct`)).then((snapshot) => {
        if (snapshot.exists())
        {

            snapshot.forEach(element => {
                console.log(element.val().role);
            });

            //Products

            $(document).ready(function () {
                $('#ds [data-toggle="tooltip"]').tooltip();
                var actions = $("#users table td:last-child").html();

                // Append table with add row form on add new button click
                $(document).on("click", "#ds .delete", function () {
                    // $.post('admindelete.php', {
                    //     "k": $(this).parents("tr").find(":first-child").text(),
                    //     "type": "courses",
                    //     "pk": "uploadid"
                    // },
                    //     function () {
                    //         console.log("helo");
                    //     }
                    // );
                    $(this).parents("tr").remove();
                    $(".add-new").removeAttr("disabled");
                }

                );
            }

            );
            $(document).ready(function () {
                var actions = $("#users table td:last-child").html();
                snapshot.forEach(element => {
                    console.log(element.index);
                    var row = '<tr>' + '<td>' + element.val().pid + '</td> <td>' + element.val().uname + '</td> <td>' + element.val().pname + '</td> <td>' + element.val().price + '</td> <td>' + actions + '</td>' + '</tr>';
                    $("#ds table").append(row);
                });

            }

            )

        }
        else
        {
            console.log("No data available");
        }
    }).catch((error) => {
        console.error(error);
    });

    get(child(dbRef, `AllOrders`)).then((snapshot) => {
        if (snapshot.exists())
        {

            snapshot.forEach(element => {
                console.log(element.val().role);
            });

            //Products

            $(document).ready(function () {
                $('#order [data-toggle="tooltip"]').tooltip();
                var actions = $("#users table td:last-child").html();

                // Append table with add row form on add new button click
                $(document).on("click", "#order .delete", function () {
                    // $.post('admindelete.php', {
                    //     "k": $(this).parents("tr").find(":first-child").text(),
                    //     "type": "courses",
                    //     "pk": "uploadid"
                    // },
                    //     function () {
                    //         console.log("helo");
                    //     }
                    // );

                    $(this).parents("tr").remove();
                    $(".add-new").removeAttr("disabled");
                }

                );
            }

            );
            $(document).ready(function () {
                var actions = $("#users table td:last-child").html();
                snapshot.forEach(element => {
                    var row = '<tr>' + '<td>' + element.val().name + '</td> <td>' + element.val().pname + '</td> <td>' + element.val().quantity + '</td> <td>' + element.val().address + '</td> <td>' + actions + '</td>' + '</tr>';
                    $("#order table").append(row);
                });

            }

            )

        }
        else
        {
            console.log("No data available");
        }
    }).catch((error) => {
        console.error(error);
    });



</script>

</html>